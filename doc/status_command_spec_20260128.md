# 상태 요청 명령어 (status) 구현 요청서

## 개요
리모트 컨트롤러에서 원격 장치의 현재 상태를 확인하기 위한 `status` 명령어 구현이 필요합니다.

---

## 1. 요청 배경

리모트 컨트롤러(em_plate_zigbee)에서 SW1 버튼을 누르면 원격 장치의 ON/OFF를 토글하는 기능이 있습니다.
현재 장치 상태를 알아야 올바른 명령(on 또는 off)을 전송할 수 있습니다.

### 동작 시나리오
```
1. 사용자가 SW1 버튼 누름
2. 컨트롤러가 "status" 명령 전송
3. 원격 장치가 현재 상태 응답
4. 컨트롤러가 상태에 따라 "on" 또는 "off" 명령 전송
   - 현재 ON 상태 → "off" 전송
   - 현재 OFF 상태 → "on" 전송
```

---

## 2. 프로토콜 명세

### 2.1 요청 (컨트롤러 → 원격 장치)

| 항목 | 내용 |
|------|------|
| 명령어 | `status` |
| 형식 | `status\r\n` |
| 설명 | 현재 장치 상태 요청 |

### 2.2 응답 (원격 장치 → 컨트롤러)

| 상태 | 응답 형식 | 설명 |
|------|-----------|------|
| ON 상태 | `on\r\n` | 장치가 켜져 있음 |
| OFF 상태 | `off\r\n` | 장치가 꺼져 있음 |

### 2.3 타이밍 요구사항

| 항목 | 값 | 비고 |
|------|-----|------|
| 응답 타임아웃 | 500ms | 컨트롤러 대기 시간 |
| 권장 응답 시간 | < 100ms | 빠른 응답 권장 |

---

## 3. 구현 예시 (원격 장치 측)

### 3.1 명령어 파싱
```c
// 수신 버퍼에서 "status" 명령 감지 시
if (strstr(rx_buffer, "status") != NULL)
{
    send_status_response();
}
```

### 3.2 응답 전송
```c
void send_status_response(void)
{
    if (device_is_on)
    {
        xbee_send("on\r\n");
    }
    else
    {
        xbee_send("off\r\n");
    }
}
```

---

## 4. 테스트 방법

### 4.1 시리얼 터미널 테스트
1. 원격 장치에 시리얼 터미널 연결
2. `status` 입력 후 Enter
3. `on` 또는 `off` 응답 확인

### 4.2 컨트롤러 연동 테스트
1. 컨트롤러와 원격 장치 Zigbee 페어링
2. SW2 + SW3 동시 누름 (상태 확인 명령)
3. 부저 응답 확인:
   - 2회 비프 = ON 상태
   - 1회 비프 = OFF 상태
   - 3회 비프 = 응답 없음/알 수 없음

---

## 5. 기존 프로토콜과의 관계

기존 xbee_protocol_20260128_111714.md 문서에 다음 명령어를 추가해야 합니다:

| 명령어 | 형식 | 설명 |
|--------|------|------|
| status | `status` | 현재 상태 조회 (응답: on/off) |

---

## 6. 참고사항

- 응답이 없을 경우 컨트롤러는 `DEV_STATE_UNKNOWN` 상태로 처리합니다
- 응답 문자열에 "on" 또는 "off"가 포함되어 있으면 인식됩니다
- 대소문자 구분 없음 (소문자 권장)

---

## 변경 이력

| 날짜 | 버전 | 내용 |
|------|------|------|
| 2026-01-28 | 1.0 | 최초 작성 |
